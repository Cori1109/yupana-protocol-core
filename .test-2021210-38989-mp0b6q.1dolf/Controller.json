{
  "contractName": "Controller",
  "abi": [],
  "michelson": "[ { \"prim\": \"parameter\",\n    \"args\":\n      [ { \"prim\": \"or\",\n          \"args\":\n            [ { \"prim\": \"or\",\n                \"args\":\n                  [ { \"prim\": \"address\", \"annots\": [ \"%setFactory\" ] },\n                    { \"prim\": \"pair\",\n                      \"args\":\n                        [ { \"prim\": \"lambda\",\n                            \"args\":\n                              [ { \"prim\": \"pair\",\n                                  \"args\":\n                                    [ { \"prim\": \"pair\",\n                                        \"args\":\n                                          [ { \"prim\": \"or\",\n                                              \"args\":\n                                                [ { \"prim\": \"or\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"or\",\n                                                          \"args\":\n                                                            [ { \"prim\": \"or\",\n                                                                \"args\":\n                                                                  [ { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%borrowAmount\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%qToken\" ] } ] },\n                                                                    { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%redeemTokens\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%user\" ] } ] } ],\n                                                                    \"annots\":\n                                                                    [ \"%borrowMiddle\" ] },\n                                                                    { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%borrowAmount\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%qToken\" ] } ] },\n                                                                    { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%redeemTokens\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%user\" ] } ] } ],\n                                                                    \"annots\":\n                                                                    [ \"%ensuredBorrow\" ] } ] },\n                                                              { \"prim\": \"or\",\n                                                                \"args\":\n                                                                  [ { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%borrowAmount\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%borrower\" ] } ] },\n                                                                    { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%qToken\" ] },\n                                                                    { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%redeemTokens\" ] } ] } ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%user\" ] } ],\n                                                                    \"annots\":\n                                                                    [ \"%ensuredLiquidate\" ] },\n                                                                    { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%borrowAmount\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%qToken\" ] } ] },\n                                                                    { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%redeemTokens\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%user\" ] } ] } ],\n                                                                    \"annots\":\n                                                                    [ \"%ensuredRedeem\" ] } ] } ] },\n                                                        { \"prim\": \"or\",\n                                                          \"args\":\n                                                            [ { \"prim\": \"or\",\n                                                                \"args\":\n                                                                  [ { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%borrowerToken\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%collateralToken\" ] } ],\n                                                                    \"annots\":\n                                                                    [ \"%exitMarket\" ] },\n                                                                    { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%borrowAmount\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%borrower\" ] } ] },\n                                                                    { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%qToken\" ] },\n                                                                    { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%redeemTokens\" ] } ] } ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%user\" ] } ],\n                                                                    \"annots\":\n                                                                    [ \"%liquidateMiddle\" ] } ] },\n                                                              { \"prim\": \"or\",\n                                                                \"args\":\n                                                                  [ { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%borrowAmount\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%qToken\" ] } ] },\n                                                                    { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%redeemTokens\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%user\" ] } ] } ],\n                                                                    \"annots\":\n                                                                    [ \"%redeemMiddle\" ] },\n                                                                    { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%qToken\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%token\" ] } ],\n                                                                    \"annots\":\n                                                                    [ \"%register\" ] } ] } ] } ] },\n                                                  { \"prim\": \"or\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"or\",\n                                                          \"args\":\n                                                            [ { \"prim\": \"or\",\n                                                                \"args\":\n                                                                  [ { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%qToken\" ] },\n                                                                    { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%amount\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%borrowerToken\" ] } ] } ],\n                                                                    \"annots\":\n                                                                    [ \"%safeBorrow\" ] },\n                                                                    { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%borrower\" ] },\n                                                                    { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%amount\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%qToken\" ] } ] } ],\n                                                                    \"annots\":\n                                                                    [ \"%safeLiquidate\" ] } ] },\n                                                              { \"prim\": \"or\",\n                                                                \"args\":\n                                                                  [ { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%amount\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%qToken\" ] } ],\n                                                                    \"annots\":\n                                                                    [ \"%safeMint\" ] },\n                                                                    { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%amount\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%qToken\" ] } ],\n                                                                    \"annots\":\n                                                                    [ \"%safeRedeem\" ] } ] } ] },\n                                                        { \"prim\": \"or\",\n                                                          \"args\":\n                                                            [ { \"prim\": \"or\",\n                                                                \"args\":\n                                                                  [ { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%amount\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%qToken\" ] } ],\n                                                                    \"annots\":\n                                                                    [ \"%safeRepay\" ] },\n                                                                    { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%oracle\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%qToken\" ] } ],\n                                                                    \"annots\":\n                                                                    [ \"%setOracle\" ] } ] },\n                                                              { \"prim\": \"or\",\n                                                                \"args\":\n                                                                  [ { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%price\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%qToken\" ] } ],\n                                                                    \"annots\":\n                                                                    [ \"%updatePrice\" ] },\n                                                                    { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%user\" ] },\n                                                                    { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%balance\" ] },\n                                                                    { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%borrow\" ] },\n                                                                    { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%exchangeRate\" ] } ] } ] } ],\n                                                                    \"annots\":\n                                                                    [ \"%updateQToken\" ] } ] } ] } ] } ] },\n                                            { \"prim\": \"address\" } ] },\n                                      { \"prim\": \"pair\",\n                                        \"args\":\n                                          [ { \"prim\": \"pair\",\n                                              \"args\":\n                                                [ { \"prim\": \"pair\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"big_map\",\n                                                          \"args\":\n                                                            [ { \"prim\":\n                                                                  \"pair\",\n                                                                \"args\":\n                                                                  [ { \"prim\":\n                                                                    \"address\" },\n                                                                    { \"prim\":\n                                                                    \"address\" } ] },\n                                                              { \"prim\": \"nat\" } ],\n                                                          \"annots\":\n                                                            [ \"%accountBorrows\" ] },\n                                                        { \"prim\": \"big_map\",\n                                                          \"args\":\n                                                            [ { \"prim\":\n                                                                  \"address\" },\n                                                              { \"prim\":\n                                                                  \"pair\",\n                                                                \"args\":\n                                                                  [ { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%borrowerToken\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%collateralToken\" ] } ] } ],\n                                                          \"annots\":\n                                                            [ \"%accountMembership\" ] } ] },\n                                                  { \"prim\": \"pair\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"big_map\",\n                                                          \"args\":\n                                                            [ { \"prim\":\n                                                                  \"pair\",\n                                                                \"args\":\n                                                                  [ { \"prim\":\n                                                                    \"address\" },\n                                                                    { \"prim\":\n                                                                    \"address\" } ] },\n                                                              { \"prim\": \"nat\" } ],\n                                                          \"annots\":\n                                                            [ \"%accountTokens\" ] },\n                                                        { \"prim\": \"address\",\n                                                          \"annots\":\n                                                            [ \"%admin\" ] } ] } ] },\n                                            { \"prim\": \"pair\",\n                                              \"args\":\n                                                [ { \"prim\": \"pair\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"address\",\n                                                          \"annots\":\n                                                            [ \"%factory\" ] },\n                                                        { \"prim\": \"big_map\",\n                                                          \"args\":\n                                                            [ { \"prim\":\n                                                                  \"address\" },\n                                                              { \"prim\":\n                                                                  \"pair\",\n                                                                \"args\":\n                                                                  [ { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%collateralFactor\" ] },\n                                                                    { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%exchangeRate\" ] } ] },\n                                                                    { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%lastPrice\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%oracle\" ] } ] } ] } ],\n                                                          \"annots\":\n                                                            [ \"%markets\" ] } ] },\n                                                  { \"prim\": \"pair\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"big_map\",\n                                                          \"args\":\n                                                            [ { \"prim\":\n                                                                  \"address\" },\n                                                              { \"prim\":\n                                                                  \"address\" } ],\n                                                          \"annots\":\n                                                            [ \"%pairs\" ] },\n                                                        { \"prim\": \"set\",\n                                                          \"args\":\n                                                            [ { \"prim\":\n                                                                  \"address\" } ],\n                                                          \"annots\":\n                                                            [ \"%qTokens\" ] } ] } ] } ] } ] },\n                                { \"prim\": \"pair\",\n                                  \"args\":\n                                    [ { \"prim\": \"list\",\n                                        \"args\": [ { \"prim\": \"operation\" } ] },\n                                      { \"prim\": \"pair\",\n                                        \"args\":\n                                          [ { \"prim\": \"pair\",\n                                              \"args\":\n                                                [ { \"prim\": \"pair\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"big_map\",\n                                                          \"args\":\n                                                            [ { \"prim\":\n                                                                  \"pair\",\n                                                                \"args\":\n                                                                  [ { \"prim\":\n                                                                    \"address\" },\n                                                                    { \"prim\":\n                                                                    \"address\" } ] },\n                                                              { \"prim\": \"nat\" } ],\n                                                          \"annots\":\n                                                            [ \"%accountBorrows\" ] },\n                                                        { \"prim\": \"big_map\",\n                                                          \"args\":\n                                                            [ { \"prim\":\n                                                                  \"address\" },\n                                                              { \"prim\":\n                                                                  \"pair\",\n                                                                \"args\":\n                                                                  [ { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%borrowerToken\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%collateralToken\" ] } ] } ],\n                                                          \"annots\":\n                                                            [ \"%accountMembership\" ] } ] },\n                                                  { \"prim\": \"pair\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"big_map\",\n                                                          \"args\":\n                                                            [ { \"prim\":\n                                                                  \"pair\",\n                                                                \"args\":\n                                                                  [ { \"prim\":\n                                                                    \"address\" },\n                                                                    { \"prim\":\n                                                                    \"address\" } ] },\n                                                              { \"prim\": \"nat\" } ],\n                                                          \"annots\":\n                                                            [ \"%accountTokens\" ] },\n                                                        { \"prim\": \"address\",\n                                                          \"annots\":\n                                                            [ \"%admin\" ] } ] } ] },\n                                            { \"prim\": \"pair\",\n                                              \"args\":\n                                                [ { \"prim\": \"pair\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"address\",\n                                                          \"annots\":\n                                                            [ \"%factory\" ] },\n                                                        { \"prim\": \"big_map\",\n                                                          \"args\":\n                                                            [ { \"prim\":\n                                                                  \"address\" },\n                                                              { \"prim\":\n                                                                  \"pair\",\n                                                                \"args\":\n                                                                  [ { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%collateralFactor\" ] },\n                                                                    { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%exchangeRate\" ] } ] },\n                                                                    { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%lastPrice\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%oracle\" ] } ] } ] } ],\n                                                          \"annots\":\n                                                            [ \"%markets\" ] } ] },\n                                                  { \"prim\": \"pair\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"big_map\",\n                                                          \"args\":\n                                                            [ { \"prim\":\n                                                                  \"address\" },\n                                                              { \"prim\":\n                                                                  \"address\" } ],\n                                                          \"annots\":\n                                                            [ \"%pairs\" ] },\n                                                        { \"prim\": \"set\",\n                                                          \"args\":\n                                                            [ { \"prim\":\n                                                                  \"address\" } ],\n                                                          \"annots\":\n                                                            [ \"%qTokens\" ] } ] } ] } ] } ] } ],\n                            \"annots\": [ \"%func\" ] },\n                          { \"prim\": \"nat\", \"annots\": [ \"%index\" ] } ],\n                      \"annots\": [ \"%setUseAction\" ] } ] },\n              { \"prim\": \"or\",\n                \"args\":\n                  [ { \"prim\": \"or\",\n                      \"args\":\n                        [ { \"prim\": \"or\",\n                            \"args\":\n                              [ { \"prim\": \"or\",\n                                  \"args\":\n                                    [ { \"prim\": \"pair\",\n                                        \"args\":\n                                          [ { \"prim\": \"pair\",\n                                              \"args\":\n                                                [ { \"prim\": \"nat\",\n                                                    \"annots\":\n                                                      [ \"%borrowAmount\" ] },\n                                                  { \"prim\": \"address\",\n                                                    \"annots\": [ \"%qToken\" ] } ] },\n                                            { \"prim\": \"pair\",\n                                              \"args\":\n                                                [ { \"prim\": \"nat\",\n                                                    \"annots\":\n                                                      [ \"%redeemTokens\" ] },\n                                                  { \"prim\": \"address\",\n                                                    \"annots\": [ \"%user\" ] } ] } ],\n                                        \"annots\": [ \"%borrowMiddle\" ] },\n                                      { \"prim\": \"pair\",\n                                        \"args\":\n                                          [ { \"prim\": \"pair\",\n                                              \"args\":\n                                                [ { \"prim\": \"nat\",\n                                                    \"annots\":\n                                                      [ \"%borrowAmount\" ] },\n                                                  { \"prim\": \"address\",\n                                                    \"annots\": [ \"%qToken\" ] } ] },\n                                            { \"prim\": \"pair\",\n                                              \"args\":\n                                                [ { \"prim\": \"nat\",\n                                                    \"annots\":\n                                                      [ \"%redeemTokens\" ] },\n                                                  { \"prim\": \"address\",\n                                                    \"annots\": [ \"%user\" ] } ] } ],\n                                        \"annots\": [ \"%ensuredBorrow\" ] } ] },\n                                { \"prim\": \"or\",\n                                  \"args\":\n                                    [ { \"prim\": \"pair\",\n                                        \"args\":\n                                          [ { \"prim\": \"pair\",\n                                              \"args\":\n                                                [ { \"prim\": \"pair\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"nat\",\n                                                          \"annots\":\n                                                            [ \"%borrowAmount\" ] },\n                                                        { \"prim\": \"address\",\n                                                          \"annots\":\n                                                            [ \"%borrower\" ] } ] },\n                                                  { \"prim\": \"pair\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"address\",\n                                                          \"annots\":\n                                                            [ \"%qToken\" ] },\n                                                        { \"prim\": \"nat\",\n                                                          \"annots\":\n                                                            [ \"%redeemTokens\" ] } ] } ] },\n                                            { \"prim\": \"address\",\n                                              \"annots\": [ \"%user\" ] } ],\n                                        \"annots\": [ \"%ensuredLiquidate\" ] },\n                                      { \"prim\": \"pair\",\n                                        \"args\":\n                                          [ { \"prim\": \"pair\",\n                                              \"args\":\n                                                [ { \"prim\": \"nat\",\n                                                    \"annots\":\n                                                      [ \"%borrowAmount\" ] },\n                                                  { \"prim\": \"address\",\n                                                    \"annots\": [ \"%qToken\" ] } ] },\n                                            { \"prim\": \"pair\",\n                                              \"args\":\n                                                [ { \"prim\": \"nat\",\n                                                    \"annots\":\n                                                      [ \"%redeemTokens\" ] },\n                                                  { \"prim\": \"address\",\n                                                    \"annots\": [ \"%user\" ] } ] } ],\n                                        \"annots\": [ \"%ensuredRedeem\" ] } ] } ] },\n                          { \"prim\": \"or\",\n                            \"args\":\n                              [ { \"prim\": \"or\",\n                                  \"args\":\n                                    [ { \"prim\": \"pair\",\n                                        \"args\":\n                                          [ { \"prim\": \"address\",\n                                              \"annots\": [ \"%borrowerToken\" ] },\n                                            { \"prim\": \"address\",\n                                              \"annots\":\n                                                [ \"%collateralToken\" ] } ],\n                                        \"annots\": [ \"%exitMarket\" ] },\n                                      { \"prim\": \"pair\",\n                                        \"args\":\n                                          [ { \"prim\": \"pair\",\n                                              \"args\":\n                                                [ { \"prim\": \"pair\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"nat\",\n                                                          \"annots\":\n                                                            [ \"%borrowAmount\" ] },\n                                                        { \"prim\": \"address\",\n                                                          \"annots\":\n                                                            [ \"%borrower\" ] } ] },\n                                                  { \"prim\": \"pair\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"address\",\n                                                          \"annots\":\n                                                            [ \"%qToken\" ] },\n                                                        { \"prim\": \"nat\",\n                                                          \"annots\":\n                                                            [ \"%redeemTokens\" ] } ] } ] },\n                                            { \"prim\": \"address\",\n                                              \"annots\": [ \"%user\" ] } ],\n                                        \"annots\": [ \"%liquidateMiddle\" ] } ] },\n                                { \"prim\": \"or\",\n                                  \"args\":\n                                    [ { \"prim\": \"pair\",\n                                        \"args\":\n                                          [ { \"prim\": \"pair\",\n                                              \"args\":\n                                                [ { \"prim\": \"nat\",\n                                                    \"annots\":\n                                                      [ \"%borrowAmount\" ] },\n                                                  { \"prim\": \"address\",\n                                                    \"annots\": [ \"%qToken\" ] } ] },\n                                            { \"prim\": \"pair\",\n                                              \"args\":\n                                                [ { \"prim\": \"nat\",\n                                                    \"annots\":\n                                                      [ \"%redeemTokens\" ] },\n                                                  { \"prim\": \"address\",\n                                                    \"annots\": [ \"%user\" ] } ] } ],\n                                        \"annots\": [ \"%redeemMiddle\" ] },\n                                      { \"prim\": \"pair\",\n                                        \"args\":\n                                          [ { \"prim\": \"address\",\n                                              \"annots\": [ \"%qToken\" ] },\n                                            { \"prim\": \"address\",\n                                              \"annots\": [ \"%token\" ] } ],\n                                        \"annots\": [ \"%register\" ] } ] } ] } ] },\n                    { \"prim\": \"or\",\n                      \"args\":\n                        [ { \"prim\": \"or\",\n                            \"args\":\n                              [ { \"prim\": \"or\",\n                                  \"args\":\n                                    [ { \"prim\": \"pair\",\n                                        \"args\":\n                                          [ { \"prim\": \"address\",\n                                              \"annots\": [ \"%qToken\" ] },\n                                            { \"prim\": \"pair\",\n                                              \"args\":\n                                                [ { \"prim\": \"nat\",\n                                                    \"annots\": [ \"%amount\" ] },\n                                                  { \"prim\": \"address\",\n                                                    \"annots\":\n                                                      [ \"%borrowerToken\" ] } ] } ],\n                                        \"annots\": [ \"%safeBorrow\" ] },\n                                      { \"prim\": \"pair\",\n                                        \"args\":\n                                          [ { \"prim\": \"address\",\n                                              \"annots\": [ \"%borrower\" ] },\n                                            { \"prim\": \"pair\",\n                                              \"args\":\n                                                [ { \"prim\": \"nat\",\n                                                    \"annots\": [ \"%amount\" ] },\n                                                  { \"prim\": \"address\",\n                                                    \"annots\": [ \"%qToken\" ] } ] } ],\n                                        \"annots\": [ \"%safeLiquidate\" ] } ] },\n                                { \"prim\": \"or\",\n                                  \"args\":\n                                    [ { \"prim\": \"pair\",\n                                        \"args\":\n                                          [ { \"prim\": \"nat\",\n                                              \"annots\": [ \"%amount\" ] },\n                                            { \"prim\": \"address\",\n                                              \"annots\": [ \"%qToken\" ] } ],\n                                        \"annots\": [ \"%safeMint\" ] },\n                                      { \"prim\": \"pair\",\n                                        \"args\":\n                                          [ { \"prim\": \"nat\",\n                                              \"annots\": [ \"%amount\" ] },\n                                            { \"prim\": \"address\",\n                                              \"annots\": [ \"%qToken\" ] } ],\n                                        \"annots\": [ \"%safeRedeem\" ] } ] } ] },\n                          { \"prim\": \"or\",\n                            \"args\":\n                              [ { \"prim\": \"or\",\n                                  \"args\":\n                                    [ { \"prim\": \"pair\",\n                                        \"args\":\n                                          [ { \"prim\": \"nat\",\n                                              \"annots\": [ \"%amount\" ] },\n                                            { \"prim\": \"address\",\n                                              \"annots\": [ \"%qToken\" ] } ],\n                                        \"annots\": [ \"%safeRepay\" ] },\n                                      { \"prim\": \"pair\",\n                                        \"args\":\n                                          [ { \"prim\": \"address\",\n                                              \"annots\": [ \"%oracle\" ] },\n                                            { \"prim\": \"address\",\n                                              \"annots\": [ \"%qToken\" ] } ],\n                                        \"annots\": [ \"%setOracle\" ] } ] },\n                                { \"prim\": \"or\",\n                                  \"args\":\n                                    [ { \"prim\": \"pair\",\n                                        \"args\":\n                                          [ { \"prim\": \"nat\",\n                                              \"annots\": [ \"%price\" ] },\n                                            { \"prim\": \"address\",\n                                              \"annots\": [ \"%qToken\" ] } ],\n                                        \"annots\": [ \"%updatePrice\" ] },\n                                      { \"prim\": \"pair\",\n                                        \"args\":\n                                          [ { \"prim\": \"address\",\n                                              \"annots\": [ \"%user\" ] },\n                                            { \"prim\": \"pair\",\n                                              \"args\":\n                                                [ { \"prim\": \"nat\",\n                                                    \"annots\": [ \"%balance\" ] },\n                                                  { \"prim\": \"pair\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"nat\",\n                                                          \"annots\":\n                                                            [ \"%borrow\" ] },\n                                                        { \"prim\": \"nat\",\n                                                          \"annots\":\n                                                            [ \"%exchangeRate\" ] } ] } ] } ],\n                                        \"annots\": [ \"%updateQToken\" ] } ] } ] } ] } ],\n                \"annots\": [ \"%useController\" ] } ] } ] },\n  { \"prim\": \"storage\",\n    \"args\":\n      [ { \"prim\": \"pair\",\n          \"args\":\n            [ { \"prim\": \"pair\",\n                \"args\":\n                  [ { \"prim\": \"pair\",\n                      \"args\":\n                        [ { \"prim\": \"pair\",\n                            \"args\":\n                              [ { \"prim\": \"big_map\",\n                                  \"args\":\n                                    [ { \"prim\": \"pair\",\n                                        \"args\":\n                                          [ { \"prim\": \"address\" },\n                                            { \"prim\": \"address\" } ] },\n                                      { \"prim\": \"nat\" } ],\n                                  \"annots\": [ \"%accountBorrows\" ] },\n                                { \"prim\": \"big_map\",\n                                  \"args\":\n                                    [ { \"prim\": \"address\" },\n                                      { \"prim\": \"pair\",\n                                        \"args\":\n                                          [ { \"prim\": \"address\",\n                                              \"annots\": [ \"%borrowerToken\" ] },\n                                            { \"prim\": \"address\",\n                                              \"annots\":\n                                                [ \"%collateralToken\" ] } ] } ],\n                                  \"annots\": [ \"%accountMembership\" ] } ] },\n                          { \"prim\": \"pair\",\n                            \"args\":\n                              [ { \"prim\": \"big_map\",\n                                  \"args\":\n                                    [ { \"prim\": \"pair\",\n                                        \"args\":\n                                          [ { \"prim\": \"address\" },\n                                            { \"prim\": \"address\" } ] },\n                                      { \"prim\": \"nat\" } ],\n                                  \"annots\": [ \"%accountTokens\" ] },\n                                { \"prim\": \"address\", \"annots\": [ \"%admin\" ] } ] } ] },\n                    { \"prim\": \"pair\",\n                      \"args\":\n                        [ { \"prim\": \"pair\",\n                            \"args\":\n                              [ { \"prim\": \"address\",\n                                  \"annots\": [ \"%factory\" ] },\n                                { \"prim\": \"big_map\",\n                                  \"args\":\n                                    [ { \"prim\": \"address\" },\n                                      { \"prim\": \"pair\",\n                                        \"args\":\n                                          [ { \"prim\": \"pair\",\n                                              \"args\":\n                                                [ { \"prim\": \"nat\",\n                                                    \"annots\":\n                                                      [ \"%collateralFactor\" ] },\n                                                  { \"prim\": \"nat\",\n                                                    \"annots\":\n                                                      [ \"%exchangeRate\" ] } ] },\n                                            { \"prim\": \"pair\",\n                                              \"args\":\n                                                [ { \"prim\": \"nat\",\n                                                    \"annots\":\n                                                      [ \"%lastPrice\" ] },\n                                                  { \"prim\": \"address\",\n                                                    \"annots\": [ \"%oracle\" ] } ] } ] } ],\n                                  \"annots\": [ \"%markets\" ] } ] },\n                          { \"prim\": \"pair\",\n                            \"args\":\n                              [ { \"prim\": \"big_map\",\n                                  \"args\":\n                                    [ { \"prim\": \"address\" },\n                                      { \"prim\": \"address\" } ],\n                                  \"annots\": [ \"%pairs\" ] },\n                                { \"prim\": \"set\",\n                                  \"args\": [ { \"prim\": \"address\" } ],\n                                  \"annots\": [ \"%qTokens\" ] } ] } ] } ],\n                \"annots\": [ \"%storage\" ] },\n              { \"prim\": \"big_map\",\n                \"args\":\n                  [ { \"prim\": \"nat\" },\n                    { \"prim\": \"lambda\",\n                      \"args\":\n                        [ { \"prim\": \"pair\",\n                            \"args\":\n                              [ { \"prim\": \"pair\",\n                                  \"args\":\n                                    [ { \"prim\": \"or\",\n                                        \"args\":\n                                          [ { \"prim\": \"or\",\n                                              \"args\":\n                                                [ { \"prim\": \"or\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"or\",\n                                                          \"args\":\n                                                            [ { \"prim\":\n                                                                  \"pair\",\n                                                                \"args\":\n                                                                  [ { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%borrowAmount\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%qToken\" ] } ] },\n                                                                    { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%redeemTokens\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%user\" ] } ] } ],\n                                                                \"annots\":\n                                                                  [ \"%borrowMiddle\" ] },\n                                                              { \"prim\":\n                                                                  \"pair\",\n                                                                \"args\":\n                                                                  [ { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%borrowAmount\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%qToken\" ] } ] },\n                                                                    { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%redeemTokens\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%user\" ] } ] } ],\n                                                                \"annots\":\n                                                                  [ \"%ensuredBorrow\" ] } ] },\n                                                        { \"prim\": \"or\",\n                                                          \"args\":\n                                                            [ { \"prim\":\n                                                                  \"pair\",\n                                                                \"args\":\n                                                                  [ { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%borrowAmount\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%borrower\" ] } ] },\n                                                                    { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%qToken\" ] },\n                                                                    { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%redeemTokens\" ] } ] } ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%user\" ] } ],\n                                                                \"annots\":\n                                                                  [ \"%ensuredLiquidate\" ] },\n                                                              { \"prim\":\n                                                                  \"pair\",\n                                                                \"args\":\n                                                                  [ { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%borrowAmount\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%qToken\" ] } ] },\n                                                                    { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%redeemTokens\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%user\" ] } ] } ],\n                                                                \"annots\":\n                                                                  [ \"%ensuredRedeem\" ] } ] } ] },\n                                                  { \"prim\": \"or\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"or\",\n                                                          \"args\":\n                                                            [ { \"prim\":\n                                                                  \"pair\",\n                                                                \"args\":\n                                                                  [ { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%borrowerToken\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%collateralToken\" ] } ],\n                                                                \"annots\":\n                                                                  [ \"%exitMarket\" ] },\n                                                              { \"prim\":\n                                                                  \"pair\",\n                                                                \"args\":\n                                                                  [ { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%borrowAmount\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%borrower\" ] } ] },\n                                                                    { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%qToken\" ] },\n                                                                    { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%redeemTokens\" ] } ] } ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%user\" ] } ],\n                                                                \"annots\":\n                                                                  [ \"%liquidateMiddle\" ] } ] },\n                                                        { \"prim\": \"or\",\n                                                          \"args\":\n                                                            [ { \"prim\":\n                                                                  \"pair\",\n                                                                \"args\":\n                                                                  [ { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%borrowAmount\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%qToken\" ] } ] },\n                                                                    { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%redeemTokens\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%user\" ] } ] } ],\n                                                                \"annots\":\n                                                                  [ \"%redeemMiddle\" ] },\n                                                              { \"prim\":\n                                                                  \"pair\",\n                                                                \"args\":\n                                                                  [ { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%qToken\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%token\" ] } ],\n                                                                \"annots\":\n                                                                  [ \"%register\" ] } ] } ] } ] },\n                                            { \"prim\": \"or\",\n                                              \"args\":\n                                                [ { \"prim\": \"or\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"or\",\n                                                          \"args\":\n                                                            [ { \"prim\":\n                                                                  \"pair\",\n                                                                \"args\":\n                                                                  [ { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%qToken\" ] },\n                                                                    { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%amount\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%borrowerToken\" ] } ] } ],\n                                                                \"annots\":\n                                                                  [ \"%safeBorrow\" ] },\n                                                              { \"prim\":\n                                                                  \"pair\",\n                                                                \"args\":\n                                                                  [ { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%borrower\" ] },\n                                                                    { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%amount\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%qToken\" ] } ] } ],\n                                                                \"annots\":\n                                                                  [ \"%safeLiquidate\" ] } ] },\n                                                        { \"prim\": \"or\",\n                                                          \"args\":\n                                                            [ { \"prim\":\n                                                                  \"pair\",\n                                                                \"args\":\n                                                                  [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%amount\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%qToken\" ] } ],\n                                                                \"annots\":\n                                                                  [ \"%safeMint\" ] },\n                                                              { \"prim\":\n                                                                  \"pair\",\n                                                                \"args\":\n                                                                  [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%amount\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%qToken\" ] } ],\n                                                                \"annots\":\n                                                                  [ \"%safeRedeem\" ] } ] } ] },\n                                                  { \"prim\": \"or\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"or\",\n                                                          \"args\":\n                                                            [ { \"prim\":\n                                                                  \"pair\",\n                                                                \"args\":\n                                                                  [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%amount\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%qToken\" ] } ],\n                                                                \"annots\":\n                                                                  [ \"%safeRepay\" ] },\n                                                              { \"prim\":\n                                                                  \"pair\",\n                                                                \"args\":\n                                                                  [ { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%oracle\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%qToken\" ] } ],\n                                                                \"annots\":\n                                                                  [ \"%setOracle\" ] } ] },\n                                                        { \"prim\": \"or\",\n                                                          \"args\":\n                                                            [ { \"prim\":\n                                                                  \"pair\",\n                                                                \"args\":\n                                                                  [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%price\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%qToken\" ] } ],\n                                                                \"annots\":\n                                                                  [ \"%updatePrice\" ] },\n                                                              { \"prim\":\n                                                                  \"pair\",\n                                                                \"args\":\n                                                                  [ { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%user\" ] },\n                                                                    { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%balance\" ] },\n                                                                    { \"prim\":\n                                                                    \"pair\",\n                                                                    \"args\":\n                                                                    [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%borrow\" ] },\n                                                                    { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%exchangeRate\" ] } ] } ] } ],\n                                                                \"annots\":\n                                                                  [ \"%updateQToken\" ] } ] } ] } ] } ] },\n                                      { \"prim\": \"address\" } ] },\n                                { \"prim\": \"pair\",\n                                  \"args\":\n                                    [ { \"prim\": \"pair\",\n                                        \"args\":\n                                          [ { \"prim\": \"pair\",\n                                              \"args\":\n                                                [ { \"prim\": \"big_map\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"pair\",\n                                                          \"args\":\n                                                            [ { \"prim\":\n                                                                  \"address\" },\n                                                              { \"prim\":\n                                                                  \"address\" } ] },\n                                                        { \"prim\": \"nat\" } ],\n                                                    \"annots\":\n                                                      [ \"%accountBorrows\" ] },\n                                                  { \"prim\": \"big_map\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"address\" },\n                                                        { \"prim\": \"pair\",\n                                                          \"args\":\n                                                            [ { \"prim\":\n                                                                  \"address\",\n                                                                \"annots\":\n                                                                  [ \"%borrowerToken\" ] },\n                                                              { \"prim\":\n                                                                  \"address\",\n                                                                \"annots\":\n                                                                  [ \"%collateralToken\" ] } ] } ],\n                                                    \"annots\":\n                                                      [ \"%accountMembership\" ] } ] },\n                                            { \"prim\": \"pair\",\n                                              \"args\":\n                                                [ { \"prim\": \"big_map\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"pair\",\n                                                          \"args\":\n                                                            [ { \"prim\":\n                                                                  \"address\" },\n                                                              { \"prim\":\n                                                                  \"address\" } ] },\n                                                        { \"prim\": \"nat\" } ],\n                                                    \"annots\":\n                                                      [ \"%accountTokens\" ] },\n                                                  { \"prim\": \"address\",\n                                                    \"annots\": [ \"%admin\" ] } ] } ] },\n                                      { \"prim\": \"pair\",\n                                        \"args\":\n                                          [ { \"prim\": \"pair\",\n                                              \"args\":\n                                                [ { \"prim\": \"address\",\n                                                    \"annots\": [ \"%factory\" ] },\n                                                  { \"prim\": \"big_map\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"address\" },\n                                                        { \"prim\": \"pair\",\n                                                          \"args\":\n                                                            [ { \"prim\":\n                                                                  \"pair\",\n                                                                \"args\":\n                                                                  [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%collateralFactor\" ] },\n                                                                    { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%exchangeRate\" ] } ] },\n                                                              { \"prim\":\n                                                                  \"pair\",\n                                                                \"args\":\n                                                                  [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%lastPrice\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%oracle\" ] } ] } ] } ],\n                                                    \"annots\": [ \"%markets\" ] } ] },\n                                            { \"prim\": \"pair\",\n                                              \"args\":\n                                                [ { \"prim\": \"big_map\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"address\" },\n                                                        { \"prim\": \"address\" } ],\n                                                    \"annots\": [ \"%pairs\" ] },\n                                                  { \"prim\": \"set\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"address\" } ],\n                                                    \"annots\": [ \"%qTokens\" ] } ] } ] } ] } ] },\n                          { \"prim\": \"pair\",\n                            \"args\":\n                              [ { \"prim\": \"list\",\n                                  \"args\": [ { \"prim\": \"operation\" } ] },\n                                { \"prim\": \"pair\",\n                                  \"args\":\n                                    [ { \"prim\": \"pair\",\n                                        \"args\":\n                                          [ { \"prim\": \"pair\",\n                                              \"args\":\n                                                [ { \"prim\": \"big_map\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"pair\",\n                                                          \"args\":\n                                                            [ { \"prim\":\n                                                                  \"address\" },\n                                                              { \"prim\":\n                                                                  \"address\" } ] },\n                                                        { \"prim\": \"nat\" } ],\n                                                    \"annots\":\n                                                      [ \"%accountBorrows\" ] },\n                                                  { \"prim\": \"big_map\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"address\" },\n                                                        { \"prim\": \"pair\",\n                                                          \"args\":\n                                                            [ { \"prim\":\n                                                                  \"address\",\n                                                                \"annots\":\n                                                                  [ \"%borrowerToken\" ] },\n                                                              { \"prim\":\n                                                                  \"address\",\n                                                                \"annots\":\n                                                                  [ \"%collateralToken\" ] } ] } ],\n                                                    \"annots\":\n                                                      [ \"%accountMembership\" ] } ] },\n                                            { \"prim\": \"pair\",\n                                              \"args\":\n                                                [ { \"prim\": \"big_map\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"pair\",\n                                                          \"args\":\n                                                            [ { \"prim\":\n                                                                  \"address\" },\n                                                              { \"prim\":\n                                                                  \"address\" } ] },\n                                                        { \"prim\": \"nat\" } ],\n                                                    \"annots\":\n                                                      [ \"%accountTokens\" ] },\n                                                  { \"prim\": \"address\",\n                                                    \"annots\": [ \"%admin\" ] } ] } ] },\n                                      { \"prim\": \"pair\",\n                                        \"args\":\n                                          [ { \"prim\": \"pair\",\n                                              \"args\":\n                                                [ { \"prim\": \"address\",\n                                                    \"annots\": [ \"%factory\" ] },\n                                                  { \"prim\": \"big_map\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"address\" },\n                                                        { \"prim\": \"pair\",\n                                                          \"args\":\n                                                            [ { \"prim\":\n                                                                  \"pair\",\n                                                                \"args\":\n                                                                  [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%collateralFactor\" ] },\n                                                                    { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%exchangeRate\" ] } ] },\n                                                              { \"prim\":\n                                                                  \"pair\",\n                                                                \"args\":\n                                                                  [ { \"prim\":\n                                                                    \"nat\",\n                                                                    \"annots\":\n                                                                    [ \"%lastPrice\" ] },\n                                                                    { \"prim\":\n                                                                    \"address\",\n                                                                    \"annots\":\n                                                                    [ \"%oracle\" ] } ] } ] } ],\n                                                    \"annots\": [ \"%markets\" ] } ] },\n                                            { \"prim\": \"pair\",\n                                              \"args\":\n                                                [ { \"prim\": \"big_map\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"address\" },\n                                                        { \"prim\": \"address\" } ],\n                                                    \"annots\": [ \"%pairs\" ] },\n                                                  { \"prim\": \"set\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"address\" } ],\n                                                    \"annots\": [ \"%qTokens\" ] } ] } ] } ] } ] } ] } ],\n                \"annots\": [ \"%useControllerLambdas\" ] } ] } ] },\n  { \"prim\": \"code\",\n    \"args\":\n      [ [ { \"prim\": \"UNPAIR\" }, { \"prim\": \"SELF_ADDRESS\" },\n          { \"prim\": \"SWAP\" },\n          { \"prim\": \"IF_LEFT\",\n            \"args\":\n              [ [ { \"prim\": \"SWAP\" }, { \"prim\": \"DROP\" },\n                  { \"prim\": \"IF_LEFT\",\n                    \"args\":\n                      [ [ { \"prim\": \"SWAP\" }, { \"prim\": \"DUP\" },\n                          { \"prim\": \"DUG\", \"args\": [ { \"int\": \"2\" } ] },\n                          { \"prim\": \"CAR\" }, { \"prim\": \"CAR\" },\n                          { \"prim\": \"CDR\" }, { \"prim\": \"CDR\" },\n                          { \"prim\": \"SENDER\" }, { \"prim\": \"COMPARE\" },\n                          { \"prim\": \"EQ\" },\n                          { \"prim\": \"IF\",\n                            \"args\":\n                              [ [ { \"prim\": \"SWAP\" }, { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"CDR\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"3\" } ] },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"CDR\" },\n                                  { \"prim\": \"CDR\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"3\" } ] },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"4\" } ] },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"CDR\" },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"CDR\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"3\" } ] },\n                                  { \"prim\": \"PAIR\" }, { \"prim\": \"PAIR\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"CAR\" },\n                                  { \"prim\": \"PAIR\" }, { \"prim\": \"PAIR\" } ],\n                                [ { \"prim\": \"DROP\" },\n                                  { \"prim\": \"PUSH\",\n                                    \"args\":\n                                      [ { \"prim\": \"string\" },\n                                        { \"string\": \"YouNotAdmin\" } ] },\n                                  { \"prim\": \"FAILWITH\" } ] ] },\n                          { \"prim\": \"NIL\",\n                            \"args\": [ { \"prim\": \"operation\" } ] },\n                          { \"prim\": \"PAIR\" } ],\n                        [ { \"prim\": \"DUP\" },\n                          { \"prim\": \"DUG\", \"args\": [ { \"int\": \"2\" } ] },\n                          { \"prim\": \"CAR\" },\n                          { \"prim\": \"DIG\", \"args\": [ { \"int\": \"2\" } ] },\n                          { \"prim\": \"CDR\" },\n                          { \"prim\": \"DIG\", \"args\": [ { \"int\": \"2\" } ] },\n                          { \"prim\": \"DUP\" },\n                          { \"prim\": \"DUG\", \"args\": [ { \"int\": \"3\" } ] },\n                          { \"prim\": \"CDR\" }, { \"prim\": \"SWAP\" },\n                          { \"prim\": \"DUP\" },\n                          { \"prim\": \"DUG\", \"args\": [ { \"int\": \"2\" } ] },\n                          { \"prim\": \"GET\" },\n                          { \"prim\": \"IF_NONE\",\n                            \"args\":\n                              [ [ { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"3\" } ] },\n                                  { \"prim\": \"CDR\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"SWAP\" }, { \"prim\": \"SOME\" },\n                                  { \"prim\": \"SWAP\" }, { \"prim\": \"UPDATE\" },\n                                  { \"prim\": \"SWAP\" }, { \"prim\": \"CAR\" },\n                                  { \"prim\": \"PAIR\" } ],\n                                [ { \"prim\": \"DROP\",\n                                    \"args\": [ { \"int\": \"3\" } ] },\n                                  { \"prim\": \"PUSH\",\n                                    \"args\":\n                                      [ { \"prim\": \"string\" },\n                                        { \"string\": \"Controller/function-set\" } ] },\n                                  { \"prim\": \"FAILWITH\" } ] ] },\n                          { \"prim\": \"NIL\",\n                            \"args\": [ { \"prim\": \"operation\" } ] },\n                          { \"prim\": \"PAIR\" } ] ] } ],\n                [ { \"prim\": \"DIG\", \"args\": [ { \"int\": \"2\" } ] },\n                  { \"prim\": \"DUP\" },\n                  { \"prim\": \"DUG\", \"args\": [ { \"int\": \"3\" } ] },\n                  { \"prim\": \"CDR\" }, { \"prim\": \"SWAP\" }, { \"prim\": \"DUP\" },\n                  { \"prim\": \"DUG\", \"args\": [ { \"int\": \"2\" } ] },\n                  { \"prim\": \"IF_LEFT\",\n                    \"args\":\n                      [ [ { \"prim\": \"IF_LEFT\",\n                            \"args\":\n                              [ [ { \"prim\": \"IF_LEFT\",\n                                    \"args\":\n                                      [ [ { \"prim\": \"IF_LEFT\",\n                                            \"args\":\n                                              [ [ { \"prim\": \"DROP\" },\n                                                  { \"prim\": \"PUSH\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"nat\" },\n                                                        { \"int\": \"10\" } ] } ],\n                                                [ { \"prim\": \"DROP\" },\n                                                  { \"prim\": \"PUSH\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"nat\" },\n                                                        { \"int\": \"11\" } ] } ] ] } ],\n                                        [ { \"prim\": \"IF_LEFT\",\n                                            \"args\":\n                                              [ [ { \"prim\": \"DROP\" },\n                                                  { \"prim\": \"PUSH\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"nat\" },\n                                                        { \"int\": \"15\" } ] } ],\n                                                [ { \"prim\": \"DROP\" },\n                                                  { \"prim\": \"PUSH\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"nat\" },\n                                                        { \"int\": \"8\" } ] } ] ] } ] ] } ],\n                                [ { \"prim\": \"IF_LEFT\",\n                                    \"args\":\n                                      [ [ { \"prim\": \"IF_LEFT\",\n                                            \"args\":\n                                              [ [ { \"prim\": \"DROP\" },\n                                                  { \"prim\": \"PUSH\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"nat\" },\n                                                        { \"int\": \"4\" } ] } ],\n                                                [ { \"prim\": \"DROP\" },\n                                                  { \"prim\": \"PUSH\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"nat\" },\n                                                        { \"int\": \"14\" } ] } ] ] } ],\n                                        [ { \"prim\": \"IF_LEFT\",\n                                            \"args\":\n                                              [ [ { \"prim\": \"DROP\" },\n                                                  { \"prim\": \"PUSH\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"nat\" },\n                                                        { \"int\": \"7\" } ] } ],\n                                                [ { \"prim\": \"DROP\" },\n                                                  { \"prim\": \"PUSH\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"nat\" },\n                                                        { \"int\": \"2\" } ] } ] ] } ] ] } ] ] } ],\n                        [ { \"prim\": \"IF_LEFT\",\n                            \"args\":\n                              [ [ { \"prim\": \"IF_LEFT\",\n                                    \"args\":\n                                      [ [ { \"prim\": \"IF_LEFT\",\n                                            \"args\":\n                                              [ [ { \"prim\": \"DROP\" },\n                                                  { \"prim\": \"PUSH\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"nat\" },\n                                                        { \"int\": \"9\" } ] } ],\n                                                [ { \"prim\": \"DROP\" },\n                                                  { \"prim\": \"PUSH\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"nat\" },\n                                                        { \"int\": \"13\" } ] } ] ] } ],\n                                        [ { \"prim\": \"IF_LEFT\",\n                                            \"args\":\n                                              [ [ { \"prim\": \"DROP\" },\n                                                  { \"prim\": \"PUSH\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"nat\" },\n                                                        { \"int\": \"5\" } ] } ],\n                                                [ { \"prim\": \"DROP\" },\n                                                  { \"prim\": \"PUSH\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"nat\" },\n                                                        { \"int\": \"6\" } ] } ] ] } ] ] } ],\n                                [ { \"prim\": \"IF_LEFT\",\n                                    \"args\":\n                                      [ [ { \"prim\": \"IF_LEFT\",\n                                            \"args\":\n                                              [ [ { \"prim\": \"DROP\" },\n                                                  { \"prim\": \"PUSH\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"nat\" },\n                                                        { \"int\": \"12\" } ] } ],\n                                                [ { \"prim\": \"DROP\" },\n                                                  { \"prim\": \"PUSH\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"nat\" },\n                                                        { \"int\": \"1\" } ] } ] ] } ],\n                                        [ { \"prim\": \"IF_LEFT\",\n                                            \"args\":\n                                              [ [ { \"prim\": \"DROP\" },\n                                                  { \"prim\": \"PUSH\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"nat\" },\n                                                        { \"int\": \"0\" } ] } ],\n                                                [ { \"prim\": \"DROP\" },\n                                                  { \"prim\": \"PUSH\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"nat\" },\n                                                        { \"int\": \"3\" } ] } ] ] } ] ] } ] ] } ] ] },\n                  { \"prim\": \"GET\" },\n                  { \"prim\": \"IF_NONE\",\n                    \"args\":\n                      [ [ { \"prim\": \"DROP\", \"args\": [ { \"int\": \"2\" } ] },\n                          { \"prim\": \"PUSH\",\n                            \"args\":\n                              [ { \"prim\": \"string\" },\n                                { \"string\": \"Controller/function-not-set\" } ] },\n                          { \"prim\": \"FAILWITH\" } ],\n                        [ { \"prim\": \"DIG\", \"args\": [ { \"int\": \"3\" } ] },\n                          { \"prim\": \"DUP\" },\n                          { \"prim\": \"DUG\", \"args\": [ { \"int\": \"4\" } ] },\n                          { \"prim\": \"CAR\" },\n                          { \"prim\": \"DIG\", \"args\": [ { \"int\": \"3\" } ] },\n                          { \"prim\": \"DIG\", \"args\": [ { \"int\": \"3\" } ] },\n                          { \"prim\": \"PAIR\" }, { \"prim\": \"PAIR\" },\n                          { \"prim\": \"EXEC\" } ] ] }, { \"prim\": \"SWAP\" },\n                  { \"prim\": \"CDR\" }, { \"prim\": \"SWAP\" }, { \"prim\": \"DUP\" },\n                  { \"prim\": \"DUG\", \"args\": [ { \"int\": \"2\" } ] },\n                  { \"prim\": \"CDR\" }, { \"prim\": \"PAIR\" }, { \"prim\": \"SWAP\" },\n                  { \"prim\": \"CAR\" }, { \"prim\": \"PAIR\" } ] ] } ] ] } ]",
  "source": "#include \"../partials/IController.ligo\"\n\nfunction setFactory (const newFactoryAddress: address; const s : fullControllerStorage) : fullReturn is\n  block {\n    if (Tezos.sender = s.storage.admin) then\n      s.storage.factory := newFactoryAddress;\n    else failwith(\"YouNotAdmin\");\n  } with (noOperations, s)\n\nfunction setUseAction (const idx : nat; const f : useControllerFunc; const s : fullControllerStorage) : fullReturn is\n  block {\n    case s.useControllerLambdas[idx] of \n      Some(n) -> failwith(\"Controller/function-set\") \n      | None -> s.useControllerLambdas[idx] := f \n    end;\n  } with (noOperations, s)\n\n[@inline] function middleController (const p : useControllerAction; const this : address; const s : fullControllerStorage) : fullReturn is\n  block {\n    const idx : nat = case p of\n      | UpdatePrice(updateParams) -> 0n\n      | SetOracle(setOracleParams) -> 1n\n      | Register(registerParams) -> 2n \n      | UpdateQToken(updateQTokenParams) -> 3n \n      | ExitMarket(membershipParams) -> 4n\n      | SafeMint(safeMintParams) -> 5n\n      | SafeRedeem(safeRedeemParams) -> 6n\n      | RedeemMiddle(redeemMiddleParams) -> 7n\n      | EnsuredRedeem(ensuredRedeemParams) -> 8n\n      | SafeBorrow(safeBorrowParams) -> 9n\n      | BorrowMiddle(borrowMiddleParams) -> 10n\n      | EnsuredBorrow(ensuredBorrowParams) -> 11n\n      | SafeRepay(safeRepayParams) -> 12n\n      | SafeLiquidate(safeLiquidateParams) -> 13n\n      | LiquidateMiddle(liquidateMiddleParams) -> 14n\n      | EnsuredLiquidate(ensuredLiquidateParams) -> 15n\n    end;\n\n    const res : return = case s.useControllerLambdas[idx] of \n      Some(f) -> f(p, this, s.storage)\n      | None -> (failwith(\"Controller/function-not-set\") : return)\n    end;\n    s.storage := res.1;\n  } with (res.0, s)\n\n[@inline] function mustContainsQTokens (const qToken : address; const s : controllerStorage) : unit is\n  block {\n    if (s.qTokens contains qToken) then skip\n    else failwith(\"NotContains\");\n  } with (unit)\n\n[@inline] function mustNotContainsQTokens (const qToken : address; const s : controllerStorage) : unit is\n  block {\n    if (s.qTokens contains qToken) then\n      failwith(\"Contains\")\n    else skip;\n  } with (unit)\n\n[@inline] function getUseEntrypoint(const tokenAddress : address) : contract(useParam) is\n  case (Tezos.get_entrypoint_opt(\"%use\", tokenAddress) : option(contract(useParam))) of \n    Some(contr) -> contr\n    | None -> (failwith(\"CantGetUseEntrypoint\") : contract(useParam))\n  end;\n\n[@inline] function getRedeemMiddleEntrypoint(const tokenAddress : address) : contract(redeemMiddleParams) is\n  case (Tezos.get_entrypoint_opt(\"%redeemMiddle\", tokenAddress) : option(contract(redeemMiddleParams))) of \n    Some(contr) -> contr\n    | None -> (failwith(\"CantGetRedeemMiddleEntrypoint\") : contract(redeemMiddleParams))\n  end;\n\n[@inline] function getUpdateControllerStateEntrypoint(const tokenAddress : address) : contract(updateControllerStateType) is\n  case (Tezos.get_entrypoint_opt(\"%updateControllerState\", tokenAddress) : option(contract(updateControllerStateType))) of \n    Some(contr) -> contr\n    | None -> (failwith(\"CantGetUpdateControllerStateEntrypoint\") : contract(updateControllerStateType))\n  end;\n\n[@inline] function getEnsuredRedeemEntrypoint(const tokenAddress : address) : contract(ensuredRedeemParams) is\n  case (Tezos.get_entrypoint_opt(\"%ensuredRedeem\", tokenAddress) : option(contract(ensuredRedeemParams))) of \n    Some(contr) -> contr\n    | None -> (failwith(\"CantGetEnsuredRedeemEntrypoint\") : contract(ensuredRedeemParams))\n  end;\n\n[@inline] function getBorrowMiddleEntrypoint(const tokenAddress : address) : contract(borrowMiddleParams) is\n  case (Tezos.get_entrypoint_opt(\"%borrowMiddle\", tokenAddress) : option(contract(borrowMiddleParams))) of \n    Some(contr) -> contr\n    | None -> (failwith(\"CantGetBorrowMiddleEntrypoint\") : contract(borrowMiddleParams))\n  end;\n\n[@inline] function getEnsuredBorrowEntrypoint(const tokenAddress : address) : contract(ensuredBorrowParams) is\n  case (Tezos.get_entrypoint_opt(\"%ensuredBorrow\", tokenAddress) : option(contract(ensuredBorrowParams))) of \n    Some(contr) -> contr\n    | None -> (failwith(\"CantGetEnsuredBorrowEntrypoint\") : contract(ensuredBorrowParams))\n  end;\n\n[@inline] function getLiquidateMiddleEntrypoint(const tokenAddress : address) : contract(liquidateMiddleParams) is\n  case (Tezos.get_entrypoint_opt(\"%liquidateMiddle\", tokenAddress) : option(contract(liquidateMiddleParams))) of \n    Some(contr) -> contr\n    | None -> (failwith(\"CantGetLiquidateMiddleEntrypoint\") : contract(liquidateMiddleParams))\n  end;\n\n[@inline] function getEnsuredLiquidateEntrypoint(const tokenAddress : address) : contract(ensuredLiquidateParams) is\n  case (Tezos.get_entrypoint_opt(\"%ensuredLiquidate\", tokenAddress) : option(contract(ensuredLiquidateParams))) of \n    Some(contr) -> contr\n    | None -> (failwith(\"CantGetEnsuredLiquidateEntrypoint\") : contract(ensuredLiquidateParams))\n  end;\n\n[@inline] function getAccountTokens (const user : address; const qToken : address; const s : controllerStorage) : nat is\n  case s.accountTokens[(user, qToken)] of\n    Some (value) -> value\n  | None -> 0n\n  end; \n\n[@inline] function getMarket (const qToken : address; const s : controllerStorage) : market is\n  block {\n    var m : market := record [\n      collateralFactor = 0n;\n      lastPrice        = 0n;\n      oracle           = (\"tz1ZZZZZZZZZZZZZZZZZZZZZZZZZZZZNkiRg\" : address);\n      exchangeRate     = 0n;\n    ];\n    case s.markets[qToken] of\n      None -> skip\n    | Some(value) -> m := value\n    end;\n  } with m\n\n[@inline] function getAccountMembership (const user : address; const s : controllerStorage) : membershipParams is\n  case s.accountMembership[user] of\n    Some (value) -> value\n  | None -> (record [borrowerToken = (\"tz1ZZZZZZZZZZZZZZZZZZZZZZZZZZZZNkiRg\" : address); collateralToken = (\"tz1ZZZZZZZZZZZZZZZZZZZZZZZZZZZZNkiRg\" : address)])\n  end;\n\n[@inline] function getAccountBorrows (const user : address; const qToken : address; const s : controllerStorage ) : nat is\n  case s.accountBorrows[(user, qToken)] of\n    Some (value) -> value\n  | None -> 0n\n  end;\n\nfunction getUserLiquidity (const user : address; const qToken : address; const redeemTokens : nat; const borrowAmount : nat; const s : controllerStorage) : getUserLiquidityReturn is\n  block {\n    var sumCollateral : nat := 0n;\n    var sumBorrow : nat := 0n;\n    var tokens : membershipParams := getAccountMembership(user, s);\n    var tokensToDenom : nat := 0n;\n    var m : market := getMarket(qToken, s);\n\n    tokensToDenom := m.collateralFactor * m.exchangeRate * m.lastPrice / accuracy / accuracy;\n    sumCollateral := sumCollateral + tokensToDenom * getAccountTokens(user, tokens.collateralToken, s) / accuracy;\n    sumBorrow := sumBorrow + m.lastPrice * getAccountBorrows(user, tokens.borrowerToken, s) / accuracy;\n\n    if tokens.collateralToken = qToken then block {\n      sumBorrow := sumBorrow + tokensToDenom * redeemTokens;\n      sumBorrow := sumBorrow + m.lastPrice * borrowAmount;\n    }\n    else skip;\n\n    var response : getUserLiquidityReturn := \n    record [\n      surplus   = 0n;\n      shortfail = 0n;\n    ];\n\n    if sumCollateral > sumBorrow then\n      response.surplus := abs(sumCollateral - sumBorrow);\n    else skip;\n\n    if sumBorrow > sumCollateral then\n      response.shortfail := abs(sumBorrow - sumCollateral);\n    else skip;\n\n  } with (response)\n\nfunction updatePrice (const p : useControllerAction; const this : address; var s : controllerStorage) : return is\n  block {\n    var operations : list(operation) := list[];\n    case p of\n    | UpdatePrice(updateParams) -> {\n      mustContainsQTokens(updateParams.qToken, s);\n      \n      var m : market := getMarket(updateParams.qToken, s);\n      \n      if Tezos.sender =/= m.oracle then\n        failwith(\"NotOracle\")\n      else skip;\n\n      m.lastPrice := updateParams.price;\n      s.markets[updateParams.qToken] := m;\n    }\n    | SetOracle(setOracleParams) -> skip\n    | Register(registerParams) -> skip\n    | UpdateQToken(updateQTokenParams) -> skip\n    | ExitMarket(membershipParams) -> skip\n    | SafeMint(safeMintParams) -> skip\n    | SafeRedeem(safeRedeemParams) -> skip\n    | RedeemMiddle(redeemMiddleParams) -> skip\n    | EnsuredRedeem(ensuredRedeemParams) -> skip\n    | SafeBorrow(safeBorrowParams) -> skip\n    | BorrowMiddle(borrowMiddleParams) -> skip\n    | EnsuredBorrow(ensuredBorrowParams) -> skip\n    | SafeRepay(safeRepayParams) -> skip\n    | SafeLiquidate(safeLiquidateParams) -> skip\n    | LiquidateMiddle(liquidateMiddleParams) -> skip\n    | EnsuredLiquidate(ensuredLiquidateParams) -> skip\n    end\n  } with (operations, s)\n\nfunction setOracle (const p : useControllerAction; const this : address; var s : controllerStorage) : return is\n  block {\n    var operations : list(operation) := list[];\n    case p of\n    | UpdatePrice(updateParams) -> skip\n    | SetOracle(setOracleParams) -> {\n      if Tezos.sender =/= s.admin then\n        failwith(\"NotAdmin\")\n      else skip;\n\n      var m : market := getMarket(setOracleParams.qToken, s);\n      m.oracle := setOracleParams.oracle;\n      s.markets[setOracleParams.qToken] := m;\n    }\n    | Register(registerParams) -> skip\n    | UpdateQToken(updateQTokenParams) -> skip\n    | ExitMarket(membershipParams) -> skip\n    | SafeMint(safeMintParams) -> skip\n    | SafeRedeem(safeRedeemParams) -> skip\n    | RedeemMiddle(redeemMiddleParams) -> skip\n    | EnsuredRedeem(ensuredRedeemParams) -> skip\n    | SafeBorrow(safeBorrowParams) -> skip\n    | BorrowMiddle(borrowMiddleParams) -> skip\n    | EnsuredBorrow(ensuredBorrowParams) -> skip\n    | SafeRepay(safeRepayParams) -> skip\n    | SafeLiquidate(safeLiquidateParams) -> skip\n    | LiquidateMiddle(liquidateMiddleParams) -> skip\n    | EnsuredLiquidate(ensuredLiquidateParams) -> skip\n    end\n  } with (operations, s)\n\nfunction register (const p : useControllerAction; const this : address; var s : controllerStorage) : return is\n  block {\n    var operations : list(operation) := list[];\n    case p of\n    | UpdatePrice(updateParams) -> skip\n    | SetOracle(setOracleParams) -> skip\n    | Register(registerParams) -> {\n      if Tezos.sender =/= s.factory then\n        failwith(\"NotFactory\")\n      else skip;\n\n      mustNotContainsQTokens(registerParams.qToken, s);\n\n      s.qTokens := Set.add(registerParams.qToken, s.qTokens);\n      s.pairs[registerParams.token] := registerParams.qToken;\n    }\n    | UpdateQToken(updateQTokenParams) -> skip\n    | ExitMarket(membershipParams) -> skip\n    | SafeMint(safeMintParams) -> skip\n    | SafeRedeem(safeRedeemParams) -> skip\n    | RedeemMiddle(redeemMiddleParams) -> skip\n    | EnsuredRedeem(ensuredRedeemParams) -> skip\n    | SafeBorrow(safeBorrowParams) -> skip\n    | BorrowMiddle(borrowMiddleParams) -> skip\n    | EnsuredBorrow(ensuredBorrowParams) -> skip\n    | SafeRepay(safeRepayParams) -> skip\n    | SafeLiquidate(safeLiquidateParams) -> skip\n    | LiquidateMiddle(liquidateMiddleParams) -> skip\n    | EnsuredLiquidate(ensuredLiquidateParams) -> skip\n    end\n  } with (operations, s)\n\nfunction updateQToken (const p : useControllerAction; const this : address; var s : controllerStorage) : return is\n  block {\n    var operations : list(operation) := list[];\n    case p of\n    | UpdatePrice(updateParams) -> skip\n    | SetOracle(setOracleParams) -> skip\n    | Register(registerParams) -> skip\n    | UpdateQToken(updateQTokenParams) -> {\n      mustContainsQTokens(Tezos.sender, s);\n\n      var m : market := getMarket(Tezos.sender, s);\n      m.exchangeRate := updateQTokenParams.exchangeRate;\n\n      s.accountTokens[(updateQTokenParams.user, Tezos.sender)] := updateQTokenParams.balance;\n      s.accountBorrows[(updateQTokenParams.user, Tezos.sender)] := updateQTokenParams.borrow;\n      s.markets[this] := m;\n    } \n    | ExitMarket(membershipParams) -> skip\n    | SafeMint(safeMintParams) -> skip\n    | SafeRedeem(safeRedeemParams) -> skip\n    | RedeemMiddle(redeemMiddleParams) -> skip\n    | EnsuredRedeem(ensuredRedeemParams) -> skip\n    | SafeBorrow(safeBorrowParams) -> skip\n    | BorrowMiddle(borrowMiddleParams) -> skip\n    | EnsuredBorrow(ensuredBorrowParams) -> skip\n    | SafeRepay(safeRepayParams) -> skip\n    | SafeLiquidate(safeLiquidateParams) -> skip\n    | LiquidateMiddle(liquidateMiddleParams) -> skip\n    | EnsuredLiquidate(ensuredLiquidateParams) -> skip\n    end\n  } with (operations, s)\n\nfunction exitMarket (const p : useControllerAction; const this : address; var s : controllerStorage) : return is\n  block {\n    var operations : list(operation) := list[];\n    case p of\n    | UpdatePrice(updateParams) -> skip\n    | SetOracle(setOracleParams) -> skip\n    | Register(registerParams) -> skip\n    | UpdateQToken(updateQTokenParams) -> skip\n    | ExitMarket(membershipParams) -> {\n      mustContainsQTokens(membershipParams.borrowerToken, s);\n      mustContainsQTokens(membershipParams.collateralToken, s);\n  \n      var tokens : membershipParams := getAccountMembership(Tezos.sender, s);\n\n      if getAccountBorrows(Tezos.sender, membershipParams.borrowerToken, s) =/= 0n then\n        failwith(\"BorrowsExists\")\n      else skip;\n      \n      remove Tezos.sender from map s.accountMembership\n    }\n    | SafeMint(safeMintParams) -> skip\n    | SafeRedeem(safeRedeemParams) -> skip\n    | RedeemMiddle(redeemMiddleParams) -> skip\n    | EnsuredRedeem(ensuredRedeemParams) -> skip\n    | SafeBorrow(safeBorrowParams) -> skip\n    | BorrowMiddle(borrowMiddleParams) -> skip\n    | EnsuredBorrow(ensuredBorrowParams) -> skip\n    | SafeRepay(safeRepayParams) -> skip\n    | SafeLiquidate(safeLiquidateParams) -> skip\n    | LiquidateMiddle(liquidateMiddleParams) -> skip\n    | EnsuredLiquidate(ensuredLiquidateParams) -> skip\n    end\n  } with (operations, s)\n\nfunction safeMint (const p : useControllerAction; const this : address; var s : controllerStorage) : return is\n  block {\n    var operations : list(operation) := list[];\n    case p of\n    | UpdatePrice(updateParams) -> skip\n    | SetOracle(setOracleParams) -> skip\n    | Register(registerParams) -> skip\n    | UpdateQToken(updateQTokenParams) -> skip\n    | ExitMarket(membershipParams) -> skip\n    | SafeMint(safeMintParams) -> {\n      mustContainsQTokens(safeMintParams.qToken, s);\n\n      operations := list [\n        Tezos.transaction(\n          Mint(record [\n            user    = Tezos.sender;\n            amount  = safeMintParams.amount;\n          ]),\n          0mutez,\n          getUseEntrypoint(safeMintParams.qToken)\n        )\n      ];\n    }\n    | SafeRedeem(safeRedeemParams) -> skip\n    | RedeemMiddle(redeemMiddleParams) -> skip\n    | EnsuredRedeem(ensuredRedeemParams) -> skip\n    | SafeBorrow(safeBorrowParams) -> skip\n    | BorrowMiddle(borrowMiddleParams) -> skip\n    | EnsuredBorrow(ensuredBorrowParams) -> skip\n    | SafeRepay(safeRepayParams) -> skip\n    | SafeLiquidate(safeLiquidateParams) -> skip\n    | LiquidateMiddle(liquidateMiddleParams) -> skip\n    | EnsuredLiquidate(ensuredLiquidateParams) -> skip\n    end\n  } with (operations, s)\n\nfunction safeRedeem (const p : useControllerAction; const this : address; var s : controllerStorage) : return is\n  block {\n    var operations : list(operation) := list[];\n    case p of\n    | UpdatePrice(updateParams) -> skip\n    | SetOracle(setOracleParams) -> skip\n    | Register(registerParams) -> skip\n    | UpdateQToken(updateQTokenParams) -> skip\n    | ExitMarket(membershipParams) -> skip\n    | SafeMint(safeMintParams) -> skip\n    | SafeRedeem(safeRedeemParams) -> {\n      mustContainsQTokens(safeRedeemParams.qToken, s);\n\n      var tokens : membershipParams := getAccountMembership(Tezos.sender, s);\n\n      if tokens.collateralToken = safeRedeemParams.qToken then block {\n        operations := list [\n          Tezos.transaction(\n            QUpdateControllerState(Tezos.sender), \n            0mutez, \n            getUpdateControllerStateEntrypoint(tokens.collateralToken)\n          );\n          Tezos.transaction(\n            record [\n              user         = Tezos.sender;\n              qToken       = safeRedeemParams.qToken;\n              redeemTokens = safeRedeemParams.amount;\n              borrowAmount = getAccountBorrows(Tezos.sender, safeRedeemParams.qToken, s);\n            ],\n            0mutez, \n            getRedeemMiddleEntrypoint(this)\n          )\n        ];\n      }\n      else operations := list [\n        Tezos.transaction(\n          Redeem(record [\n            user = Tezos.sender;\n            amount  = safeRedeemParams.amount;\n          ]), \n          0mutez, \n          getUseEntrypoint(safeRedeemParams.qToken)\n        )\n      ];\n    }\n    | RedeemMiddle(redeemMiddleParams) -> skip\n    | EnsuredRedeem(ensuredRedeemParams) -> skip\n    | SafeBorrow(safeBorrowParams) -> skip\n    | BorrowMiddle(borrowMiddleParams) -> skip\n    | EnsuredBorrow(ensuredBorrowParams) -> skip\n    | SafeRepay(safeRepayParams) -> skip\n    | SafeLiquidate(safeLiquidateParams) -> skip\n    | LiquidateMiddle(liquidateMiddleParams) -> skip\n    | EnsuredLiquidate(ensuredLiquidateParams) -> skip\n    end\n  } with (operations, s)\n\nfunction redeemMiddle (const p : useControllerAction; const this : address; var s : controllerStorage) : return is\n  block {\n    var operations : list(operation) := list[];\n    case p of\n    | UpdatePrice(updateParams) -> skip\n    | SetOracle(setOracleParams) -> skip\n    | Register(registerParams) -> skip\n    | UpdateQToken(updateQTokenParams) -> skip\n    | ExitMarket(membershipParams) -> skip\n    | SafeMint(safeMintParams) -> skip\n    | SafeRedeem(safeRedeemParams) -> skip\n    | RedeemMiddle(redeemMiddleParams) -> {\n      if Tezos.sender =/= this then\n        failwith(\"NotSelfAddress\")\n      else skip;\n\n      operations := list [\n        Tezos.transaction(\n          record [\n            user         = redeemMiddleParams.user;\n            qToken       = redeemMiddleParams.qToken;\n            redeemTokens = redeemMiddleParams.redeemTokens;\n            borrowAmount = redeemMiddleParams.borrowAmount;\n          ],\n          0mutez, \n          getEnsuredRedeemEntrypoint(this)\n        )\n      ];\n    }\n    | EnsuredRedeem(ensuredRedeemParams) -> skip\n    | SafeBorrow(safeBorrowParams) -> skip\n    | BorrowMiddle(borrowMiddleParams) -> skip\n    | EnsuredBorrow(ensuredBorrowParams) -> skip\n    | SafeRepay(safeRepayParams) -> skip\n    | SafeLiquidate(safeLiquidateParams) -> skip\n    | LiquidateMiddle(liquidateMiddleParams) -> skip\n    | EnsuredLiquidate(ensuredLiquidateParams) -> skip\n    end\n  } with (operations, s)\n\nfunction ensuredRedeem (const p : useControllerAction; const this : address; var s : controllerStorage) : return is\n  block {\n    var operations : list(operation) := list[];\n    case p of\n    | UpdatePrice(updateParams) -> skip\n    | SetOracle(setOracleParams) -> skip\n    | Register(registerParams) -> skip\n    | UpdateQToken(updateQTokenParams) -> skip\n    | ExitMarket(membershipParams) -> skip\n    | SafeMint(safeMintParams) -> skip\n    | SafeRedeem(safeRedeemParams) -> skip\n    | RedeemMiddle(redeemMiddleParams) -> skip\n    | EnsuredRedeem(ensuredRedeemParams) -> {\n      if Tezos.sender =/= this then\n        failwith(\"NotSelfAddress\")\n      else skip;\n\n      const response = getUserLiquidity(ensuredRedeemParams.user, ensuredRedeemParams.qToken, ensuredRedeemParams.redeemTokens, ensuredRedeemParams.borrowAmount, s);\n      \n      if response.shortfail =/= 0n then\n        failwith(\"ShortfailNotZero\")\n      else skip;\n\n      operations := list [\n        Tezos.transaction(\n          Redeem(record [\n            user    = ensuredRedeemParams.user;\n            amount  = ensuredRedeemParams.redeemTokens;\n          ]),\n          0mutez,\n          getUseEntrypoint(ensuredRedeemParams.qToken)\n        )\n      ];\n    }\n    | SafeBorrow(safeBorrowParams) -> skip\n    | BorrowMiddle(borrowMiddleParams) -> skip\n    | EnsuredBorrow(ensuredBorrowParams) -> skip\n    | SafeRepay(safeRepayParams) -> skip\n    | SafeLiquidate(safeLiquidateParams) -> skip\n    | LiquidateMiddle(liquidateMiddleParams) -> skip\n    | EnsuredLiquidate(ensuredLiquidateParams) -> skip\n    end\n  } with (operations, s)\n\nfunction safeBorrow (const p : useControllerAction; const this : address; var s : controllerStorage) : return is\n  block {\n    var operations : list(operation) := list[];\n    case p of\n    | UpdatePrice(updateParams) -> skip\n    | SetOracle(setOracleParams) -> skip\n    | Register(registerParams) -> skip\n    | UpdateQToken(updateQTokenParams) -> skip\n    | ExitMarket(membershipParams) -> skip\n    | SafeMint(safeMintParams) -> skip\n    | SafeRedeem(safeRedeemParams) -> skip\n    | RedeemMiddle(redeemMiddleParams) -> skip\n    | EnsuredRedeem(ensuredRedeemParams) -> skip\n    | SafeBorrow(safeBorrowParams) -> {\n      mustContainsQTokens(safeBorrowParams.qToken, s);\n      mustContainsQTokens(safeBorrowParams.borrowerToken, s);\n\n\n      var tokens : membershipParams := getAccountMembership(Tezos.sender, s);\n\n      if tokens.collateralToken = safeBorrowParams.qToken then\n        failwith(\"AlreadyEnteredToMarket\")\n      else skip;\n\n      tokens.collateralToken := safeBorrowParams.qToken;\n      tokens.borrowerToken := safeBorrowParams.borrowerToken;\n\n      s.accountMembership[Tezos.sender] := tokens;\n\n      // borrowAmount = getAccountBorrows(Tezos.sender, safeBorrowParams.qToken, s);\n\n      operations := list [\n        Tezos.transaction(\n          QUpdateControllerState(Tezos.sender),\n          0mutez, \n          getUpdateControllerStateEntrypoint(safeBorrowParams.borrowerToken)\n        );\n        Tezos.transaction(\n          record [\n            user         = Tezos.sender;\n            qToken       = safeBorrowParams.borrowerToken;\n            redeemTokens = safeBorrowParams.amount;\n            borrowAmount = safeBorrowParams.amount;\n          ],\n          0mutez,\n          getBorrowMiddleEntrypoint(this)\n        )\n      ];\n    }\n    | BorrowMiddle(borrowMiddleParams) -> skip\n    | EnsuredBorrow(ensuredBorrowParams) -> skip\n    | SafeRepay(safeRepayParams) -> skip\n    | SafeLiquidate(safeLiquidateParams) -> skip\n    | LiquidateMiddle(liquidateMiddleParams) -> skip\n    | EnsuredLiquidate(ensuredLiquidateParams) -> skip\n    end\n  } with (operations, s)\n\nfunction borrowMiddle (const p : useControllerAction; const this : address; var s : controllerStorage) : return is\n  block {\n    var operations : list(operation) := list[];\n    case p of\n    | UpdatePrice(updateParams) -> skip\n    | SetOracle(setOracleParams) -> skip\n    | Register(registerParams) -> skip\n    | UpdateQToken(updateQTokenParams) -> skip\n    | ExitMarket(membershipParams) -> skip\n    | SafeMint(safeMintParams) -> skip\n    | SafeRedeem(safeRedeemParams) -> skip\n    | RedeemMiddle(redeemMiddleParams) -> skip\n    | EnsuredRedeem(ensuredRedeemParams) -> skip\n    | SafeBorrow(safeBorrowParams) -> skip\n    | BorrowMiddle(borrowMiddleParams) -> {\n      if Tezos.sender =/= this then\n        failwith(\"NotSelfAddress\")\n      else skip;\n\n      operations := list [\n        Tezos.transaction(\n          record [\n            user         = borrowMiddleParams.user;\n            qToken       = borrowMiddleParams.qToken;\n            redeemTokens = borrowMiddleParams.redeemTokens;\n            borrowAmount = borrowMiddleParams.borrowAmount;\n          ],\n          0mutez, \n          getEnsuredBorrowEntrypoint(this)\n        )\n      ];\n    }\n    | EnsuredBorrow(ensuredBorrowParams) -> skip\n    | SafeRepay(safeRepayParams) -> skip\n    | SafeLiquidate(safeLiquidateParams) -> skip\n    | LiquidateMiddle(liquidateMiddleParams) -> skip\n    | EnsuredLiquidate(ensuredLiquidateParams) -> skip\n    end\n  } with (operations, s)\n\nfunction ensuredBorrow (const p : useControllerAction; const this : address; var s : controllerStorage) : return is\n  block {\n    var operations : list(operation) := list[];\n    case p of\n    | UpdatePrice(updateParams) -> skip\n    | SetOracle(setOracleParams) -> skip\n    | Register(registerParams) -> skip\n    | UpdateQToken(updateQTokenParams) -> skip\n    | ExitMarket(membershipParams) -> skip\n    | SafeMint(safeMintParams) -> skip\n    | SafeRedeem(safeRedeemParams) -> skip\n    | RedeemMiddle(redeemMiddleParams) -> skip\n    | EnsuredRedeem(ensuredRedeemParams) -> skip\n    | SafeBorrow(safeBorrowParams) -> skip\n    | BorrowMiddle(borrowMiddleParams) -> skip\n    | EnsuredBorrow(ensuredBorrowParams) -> {\n      if Tezos.sender =/= this then\n        failwith(\"NotSelfAddress\")\n      else skip;\n\n      const response = getUserLiquidity(ensuredBorrowParams.user, ensuredBorrowParams.qToken, ensuredBorrowParams.redeemTokens, ensuredBorrowParams.borrowAmount, s);\n      \n      if response.shortfail =/= 0n then\n        failwith(\"ShortfailNotZero\")\n      else skip;\n\n      operations := list [\n        Tezos.transaction(\n          Borrow(record [\n            user   = ensuredBorrowParams.user;\n            amount = ensuredBorrowParams.borrowAmount;\n          ]),\n          0mutez,\n          getUseEntrypoint(ensuredBorrowParams.qToken)\n        )\n      ];\n    }\n    | SafeRepay(safeRepayParams) -> skip\n    | SafeLiquidate(safeLiquidateParams) -> skip\n    | LiquidateMiddle(liquidateMiddleParams) -> skip\n    | EnsuredLiquidate(ensuredLiquidateParams) -> skip\n    end\n  } with (operations, s)\n\nfunction safeRepay (const p : useControllerAction; const this : address; var s : controllerStorage) : return is\n  block {\n    var operations : list(operation) := list[];\n    case p of\n    | UpdatePrice(updateParams) -> skip\n    | SetOracle(setOracleParams) -> skip\n    | Register(registerParams) -> skip\n    | UpdateQToken(updateQTokenParams) -> skip\n    | ExitMarket(membershipParams) -> skip\n    | SafeMint(safeMintParams) -> skip\n    | SafeRedeem(safeRedeemParams) -> skip\n    | RedeemMiddle(redeemMiddleParams) -> skip\n    | EnsuredRedeem(ensuredRedeemParams) -> skip\n    | SafeBorrow(safeBorrowParams) -> skip\n    | BorrowMiddle(borrowMiddleParams) -> skip\n    | EnsuredBorrow(ensuredBorrowParams) -> skip\n    | SafeRepay(safeRepayParams) -> {\n      mustContainsQTokens(safeRepayParams.qToken, s);\n\n      operations := list [\n        Tezos.transaction(\n          Repay(record [\n            user    = Tezos.sender;\n            amount  = safeRepayParams.amount;\n          ]),\n          0mutez, \n          getUseEntrypoint(safeRepayParams.qToken)\n        )\n      ];\n    }\n    | SafeLiquidate(safeLiquidateParams) -> skip\n    | LiquidateMiddle(liquidateMiddleParams) -> skip\n    | EnsuredLiquidate(ensuredLiquidateParams) -> skip\n    end\n  } with (operations, s)\n\nfunction safeLiquidate (const p : useControllerAction; const this : address; var s : controllerStorage) : return is\n  block {\n    var operations : list(operation) := list[];\n    case p of\n    | UpdatePrice(updateParams) -> skip\n    | SetOracle(setOracleParams) -> skip\n    | Register(registerParams) -> skip\n    | UpdateQToken(updateQTokenParams) -> skip\n    | ExitMarket(membershipParams) -> skip\n    | SafeMint(safeMintParams) -> skip\n    | SafeRedeem(safeRedeemParams) -> skip\n    | RedeemMiddle(redeemMiddleParams) -> skip\n    | EnsuredRedeem(ensuredRedeemParams) -> skip\n    | SafeBorrow(safeBorrowParams) -> skip\n    | BorrowMiddle(borrowMiddleParams) -> skip\n    | EnsuredBorrow(ensuredBorrowParams) -> skip\n    | SafeRepay(safeRepayParams) -> skip\n    | SafeLiquidate(safeLiquidateParams) -> {\n      mustContainsQTokens(safeLiquidateParams.qToken, s);\n\n      var tokens : membershipParams := getAccountMembership(Tezos.sender, s);\n\n      operations := list [\n        Tezos.transaction(\n          QUpdateControllerState(Tezos.sender), \n          0mutez, \n          getUpdateControllerStateEntrypoint(tokens.collateralToken)\n        )\n      ];\n\n      operations := Tezos.transaction(\n        record [\n            user         = Tezos.sender;\n            borrower     = safeLiquidateParams.borrower;\n            qToken       = safeLiquidateParams.qToken;\n            redeemTokens = safeLiquidateParams.amount;\n            borrowAmount = getAccountBorrows(safeLiquidateParams.borrower, safeLiquidateParams.qToken, s);\n        ], \n        0mutez, \n        getLiquidateMiddleEntrypoint(this)\n      ) # operations;\n    }\n    | LiquidateMiddle(liquidateMiddleParams) -> skip\n    | EnsuredLiquidate(ensuredLiquidateParams) -> skip\n    end\n  } with (operations, s)\n\nfunction liquidateMiddle (const p : useControllerAction; const this : address; var s : controllerStorage) : return is\n  block {\n    var operations : list(operation) := list[];\n    case p of\n    | UpdatePrice(updateParams) -> skip\n    | SetOracle(setOracleParams) -> skip\n    | Register(registerParams) -> skip\n    | UpdateQToken(updateQTokenParams) -> skip\n    | ExitMarket(membershipParams) -> skip\n    | SafeMint(safeMintParams) -> skip\n    | SafeRedeem(safeRedeemParams) -> skip\n    | RedeemMiddle(redeemMiddleParams) -> skip\n    | EnsuredRedeem(ensuredRedeemParams) -> skip\n    | SafeBorrow(safeBorrowParams) -> skip\n    | BorrowMiddle(borrowMiddleParams) -> skip\n    | EnsuredBorrow(ensuredBorrowParams) -> skip\n    | SafeRepay(safeRepayParams) -> skip\n    | SafeLiquidate(safeLiquidateParams) -> skip\n    | LiquidateMiddle(liquidateMiddleParams) -> {\n      if Tezos.sender =/= this then\n        failwith(\"NotSelfAddress\")\n      else skip;\n      \n      operations := list [\n        Tezos.transaction(\n          record [\n              user         = liquidateMiddleParams.user;\n              borrower     = liquidateMiddleParams.borrower;\n              qToken       = liquidateMiddleParams.qToken;\n              redeemTokens = liquidateMiddleParams.redeemTokens;\n              borrowAmount = liquidateMiddleParams.borrowAmount;\n          ], \n          0mutez,\n          getEnsuredLiquidateEntrypoint(this)\n        )\n      ];\n    }\n    | EnsuredLiquidate(ensuredLiquidateParams) -> skip\n    end\n  } with (operations, s)\n\nfunction ensuredLiquidate (const p : useControllerAction; const this : address; var s : controllerStorage) : return is\n  block {\n    var operations : list(operation) := list[];\n    case p of\n    | UpdatePrice(updateParams) -> skip\n    | SetOracle(setOracleParams) -> skip\n    | Register(registerParams) -> skip\n    | UpdateQToken(updateQTokenParams) -> skip\n    | ExitMarket(membershipParams) -> skip\n    | SafeMint(safeMintParams) -> skip\n    | SafeRedeem(safeRedeemParams) -> skip\n    | RedeemMiddle(redeemMiddleParams) -> skip\n    | EnsuredRedeem(ensuredRedeemParams) -> skip\n    | SafeBorrow(safeBorrowParams) -> skip\n    | BorrowMiddle(borrowMiddleParams) -> skip\n    | EnsuredBorrow(ensuredBorrowParams) -> skip\n    | SafeRepay(safeRepayParams) -> skip\n    | SafeLiquidate(safeLiquidateParams) -> skip\n    | LiquidateMiddle(liquidateMiddleParams) -> skip\n    | EnsuredLiquidate(ensuredLiquidateParams) -> {\n      if Tezos.sender =/= this then\n        failwith(\"NotSelfAddress\")\n      else skip;\n\n      const response = getUserLiquidity(ensuredLiquidateParams.user, ensuredLiquidateParams.qToken, ensuredLiquidateParams.redeemTokens, ensuredLiquidateParams.borrowAmount, s);\n\n      if response.shortfail =/= 0n then\n        failwith(\"ShortfailNotZero\")\n      else skip;\n\n      operations := list [\n        Tezos.transaction(\n          Liquidate(record [\n            liquidator     = ensuredLiquidateParams.user;\n            borrower       = ensuredLiquidateParams.borrower;\n            amount         = ensuredLiquidateParams.redeemTokens;\n          ]), \n          0mutez, \n          getUseEntrypoint(ensuredLiquidateParams.qToken)\n        )\n      ];\n    }\n    end\n  } with (operations, s)\n\nfunction main (const p : entryAction; const s : fullControllerStorage) : fullReturn is\n  block {\n    const this: address = Tezos.self_address;\n  } with case p of\n      | UseController(params)         -> middleController(params, this, s)\n      | SetUseAction(params)          -> setUseAction(params.index, params.func, s)\n      | SetFactory(params)            -> setFactory(params, s)\n    end\n",
  "sourcePath": "/Users/oleh/Desktop/BasicLendingProtocol/contracts/main/Controller.ligo",
  "compiler": {
    "name": "ligo",
    "version": "next"
  },
  "networks": {},
  "schemaVersion": "3.2.0-tezos.1",
  "updatedAt": "2021-03-10T17:28:31.294Z"
}